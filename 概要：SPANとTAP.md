# SPAN / TAP 解説（通信の透明性における配置戦略）

## 概要：SPANとTAPとは？

| 項目 | SPAN | TAP |
|------|------|-----|
| 形式 | ソフトウェアベース（スイッチの機能） | ハードウェアベース（物理装置） |
| 設置 | スイッチで設定 | 回線に物理的に挿入 |
| 通信への影響 | 場合によってはあり（CPU負荷など） | 原則なし（パッシブ動作） |
| 透過性 | 高くない（誤設定や負荷の影響あり） | 非常に高い（ミラーハードウェア） |

---

## 1. SPAN（Switched Port Analyzer）とは

###  特徴

- **スイッチの機能**を利用して、指定ポートのトラフィックを別ポートに**ミラーリング（コピー）**する。
- **ネットワークパケットキャプチャやIDS/IPS**でよく使われる。

### 🔧 Ciscoスイッチでの使用例

```bash
monitor session 1 source interface Gi1/0/1
monitor session 1 destination interface Gi1/0/24
```
※Gi1/0/1ポートの通信をGi1/0/24にミラー。

### 注意点

- スイッチのリソースを使用 → **高負荷で取りこぼし**の可能性。
- VLAN設定ミスなどで**見えない通信が発生**することも。
- **障害時にSPANが機能しなくなるリスク**あり。

---

## 2. TAP（Test Access Point）とは

### 特徴

- **物理的な装置**を使って、通信をパッシブに**分岐・コピー**する。
- 「A←→B」の間に設置し、A→B / B→A をキャプチャ用デバイスに送信。

### 💡 実装例

- 光ファイバTAP、RJ45（Copper）TAPなど。
- セキュリティ用途（Snort, Suricata）やフォレンジック調査に最適。

###  メリット

- **取りこぼしなし**：電気/光信号を分岐。
- **ネットワークに影響を与えない**。
- **完全に透過的**で存在を検出されにくい。

### デメリット

- **物理装置の導入コスト**が必要。
- 設置時に**通信断が必要になる可能性**あり。

---

## セキュリティ視点での違い

| 観点 | SPAN | TAP |
|------|------|-----|
| 秘匿性 | ミラー設定がバレる可能性あり | 存在がバレにくい |
| 安定性 | 負荷・設定ミスでミラー失敗あり | 通信品質への影響ほぼなし |
| 可用性 | スイッチ依存 | 独立しており障害に強い |

---

## まとめ：使い分けの目安

| 条件 | 推奨 |
|------|------|
| 一時的なトラブル調査・コスト重視 | SPAN |
| 常時監視・フォレンジック・高セキュリティ | TAP |
| 高可用性・高負荷な本番環境の監視 | TAPが望ましい |

---

## 🚀 応用例

- **SOC（Security Operation Center）**：TAPで常時全トラフィックを監視。
- **EDR/NDR連携監視基盤**：TAP出力をセキュリティ製品へ。
- **仮想環境**：vSwitchでは **vSPAN（仮想ポートミラー）** を使用。

---

> 📘 参考：TAPを使うときは専用の「インライン型」か「パッシブ型」かの選定も重要です。
